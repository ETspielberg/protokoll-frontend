{"version":3,"sources":["webpack:///./node_modules/primeng/dialog.js","webpack:///./src/app/analysis/analysis.component.html","webpack:///./src/app/analysis/analysis.component.ts","webpack:///./src/app/analysis/analysis.module.ts","webpack:///./src/app/analysis/analysis.routing.ts","webpack:///./src/app/model/Eventanalysis.ts","webpack:///./src/app/model/TitleAction.ts"],"names":[],"mappings":"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","file":"analysis-analysis-module.js","sourcesContent":["/* Shorthand */\n\"use strict\";\nfunction __export(m) {\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\n}\nObject.defineProperty(exports, \"__esModule\", { value: true });\n__export(require(\"./components/dialog/dialog\"));","module.exports = \"<h2>{{'title.analysis' | translate}}</h2>\\r\\n<p-dialog *ngIf=\\\"memorylistService.activeMemorylistItem.titleActions\\\" [(visible)]=\\\"show['dialog']\\\">\\r\\n  <p-header>\\r\\n    {{'task' | translate}}\\r\\n  </p-header>\\r\\n  <p-table [value]=\\\"memorylistService.activeMemorylistItem.titleActions\\\">\\r\\n    <ng-template pTemplate=\\\"header\\\">\\r\\n      <tr>\\r\\n        <th>{{'action' | translate}}</th>\\r\\n        <th>{{'shelfmark' | translate}}</th>\\r\\n        <th>{{'number' | translate}}</th>\\r\\n        <th>{{'collection.from' | translate}}</th>\\r\\n        <th>{{'collection.to' | translate}}</th>\\r\\n      </tr>\\r\\n    </ng-template>\\r\\n    <ng-template pTemplate=\\\"body\\\" let-action>\\r\\n      <tr>\\r\\n        <td>{{action.actionType}}</td>\\r\\n        <td>{{action.shelfmark}}</td>\\r\\n        <td>\\r\\n          <p-spinner [min]=\\\"0\\\" [max]=\\\"filterService.statsCollection.get(action.collectionFrom)\\\" [(ngModel)]=\\\"action.number\\\"></p-spinner>\\r\\n        </td>\\r\\n        <td><p-dropdown [options]=\\\"collectionOptions\\\" [(ngModel)]=\\\"action.collectionFrom\\\"></p-dropdown></td>\\r\\n        <td pEditableColumn>\\r\\n          <p-cellEditor>\\r\\n            <ng-template pTemplate=\\\"input\\\">\\r\\n              <input pInputText type=\\\"text\\\" [(ngModel)]=\\\"action.collectionTo\\\">\\r\\n            </ng-template>\\r\\n            <ng-template pTemplate=\\\"output\\\">\\r\\n              {{action.collectionTo}}\\r\\n            </ng-template>\\r\\n          </p-cellEditor>\\r\\n        </td>\\r\\n        <td><button pButton type=\\\"button\\\" (click)=\\\"memorylistService.removeTitleAction(action)\\\"></button></td>\\r\\n      </tr>\\r\\n    </ng-template>\\r\\n  </p-table>\\r\\n  <p-footer>\\r\\n    <button style=\\\"float: left;\\\" class=\\\"ui-button-warning\\\" type=\\\"button\\\" pButton (click)=\\\"show['deletionDialog'] = false\\\"\\r\\n            label=\\\"{{'ok' | translate}}\\\" icon=\\\"pi pi-table\\\" [disabled]=\\\"memorylistService.activeMemorylistItem.titleActions.length == 0\\\"></button>\\r\\n  </p-footer>\\r\\n</p-dialog>\\r\\n<div class=\\\"ui-g\\\">\\r\\n  <div class=\\\"ui-g-8\\\">\\r\\n    <p>{{'analysis.description.short' | translate}}</p>\\r\\n    <p-table #danalysis [value]=\\\"analyses\\\" selectionMode=\\\"single\\\" [(selection)]=\\\"activeAnalysis\\\"\\r\\n             sortField=\\\"year\\\" [sortOrder]=\\\"1\\\" dataKey=\\\"years\\\"\\r\\n             (onRowSelect)=\\\"calculateDeletionProposal()\\\">\\r\\n      <ng-template pTemplate=\\\"caption\\\">\\r\\n        <div class=\\\"ui-helper-clearfix\\\">\\r\\n          <button type=\\\"button\\\" pButton icon=\\\"pi pi-table\\\" iconPos=\\\"left\\\" label=\\\"Export\\\" (click)=\\\"danalysis.exportCSV()\\\"\\r\\n                  style=\\\"float:left\\\" ></button>\\r\\n        </div>\\r\\n      </ng-template>\\r\\n      <ng-template pTemplate=\\\"header\\\">\\r\\n        <tr>\\r\\n          <th>{{'years' | translate}}</th>\\r\\n          <th>{{'max.loans' | translate}}</th>\\r\\n          <th>{{'last.stock' | translate}}</th>\\r\\n          <th>{{'unused.items' | translate}}</th>\\r\\n        </tr>\\r\\n      </ng-template>\\r\\n      <ng-template pTemplate=\\\"body\\\" let-analysis>\\r\\n        <tr [pSelectableRow]=\\\"analysis\\\">\\r\\n          <td>{{analysis.years}}</td>\\r\\n          <td>{{analysis.maxLoansAbs}}</td>\\r\\n          <td>{{analysis.lastStock}}</td>\\r\\n          <td>{{analysis.lastStock - analysis.maxLoansAbs}}</td>\\r\\n        </tr>\\r\\n      </ng-template>\\r\\n\\r\\n    </p-table>\\r\\n\\r\\n  </div>\\r\\n  <div class=\\\"ui-g-4\\\" *ngIf=\\\"activeAnalysis\\\">\\r\\n\\r\\n    <p>In den letzten {{activeAnalysis.years}} Jahren wurden von den vorhandenen\\r\\n      {{activeAnalysis.lastStock}} Exemplaren {{activeAnalysis.lastStock - activeAnalysis.maxLoansAbs}}\\r\\n      nicht genutzt.</p>\\r\\n\\r\\n    <p-slider [(ngModel)]=\\\"staticBuffer\\\" [min]=\\\"0\\\" [max]=\\\"100\\\"\\r\\n              (onChange)=\\\"calculateDeletionProposal()\\\"></p-slider>\\r\\n\\r\\n    <p>Bei einer Reserve von {{staticBuffer}} % ergibt sich ein Vorschlag zur Aussonderung von</p>\\r\\n\\r\\n    <p style=\\\"color:darkred; font-size: x-large; font-weight: bolder;\\\"> {{deletionProposal |\\r\\n      number:'1.0-0'}} Exemplar(en)</p>\\r\\n\\r\\n    <button pButton type=\\\"button\\\" class=\\\"ui-button-danger\\\" icon=\\\"fa-trash\\\" iconPos=\\\"right\\\" label=\\\"Aussondern\\\"\\r\\n            (click)=\\\"prepareDeletion()\\\"></button>\\r\\n  </div>\\r\\n  <div class=\\\"ui-g-4\\\" *ngIf=\\\"!activeAnalysis\\\">\\r\\n    <p>{{'select.years.for.analysis' | translate}}</p>\\r\\n  </div>\\r\\n</div>\\r\\n\"","import {Component, OnInit} from '@angular/core';\r\nimport {Eventanalysis} from '../model/Eventanalysis';\r\nimport {DataService} from '../service/data.service';\r\nimport {ItemlistModule} from '../itemlist/itemlist.module';\r\nimport {MemorylistService} from '../service/memorylist.service';\r\nimport {GetterService} from '../service/getter.service';\r\nimport {TitleAction} from '../model/TitleAction';\r\nimport {FilterService} from '../service/filter.service';\r\nimport {MemoryListItem} from '../model/MemoryListItem';\r\nimport {SelectItem} from 'primeng/api';\r\n\r\n@Component({\r\n  selector: 'app-analysis',\r\n  templateUrl: 'analysis.component.html'\r\n})\r\n\r\nexport class AnalysisComponent implements OnInit {\r\n\r\n  constructor(private dataService: DataService,\r\n              public filterService: FilterService,\r\n              public getterService: GetterService,\r\n              public memorylistService: MemorylistService) {\r\n  }\r\n\r\n  public show = {};\r\n\r\n  public eventanalysiss: Map<number, Eventanalysis>;\r\n\r\n  public analyses: Eventanalysis[];\r\n\r\n  public activeAnalysis: Eventanalysis;\r\n\r\n  public staticBuffer: number;\r\n\r\n  public deletionProposal: number;\r\n\r\n  public yearsOfLoans: number;\r\n\r\n  public titleActions: TitleAction[] = [];\r\n\r\n  public collectionOptions: SelectItem[] = [];\r\n\r\n  ngOnInit() {\r\n    this.filterService.filterChanged$.subscribe(\r\n      value => {\r\n        this.buildCollectionOptions();\r\n        this.reset();\r\n      }\r\n    );\r\n    this.show['dialog'] = false;\r\n    this.analyses = [];\r\n    this.staticBuffer = 20;\r\n    this.deletionProposal = 0;\r\n    this.yearsOfLoans = 5;\r\n    if (this.dataService.printData) {\r\n      this.reset();\r\n    }\r\n    this.buildCollectionOptions();\r\n  }\r\n\r\n  buildCollectionOptions() {\r\n    this.filterService.uniqueCollections.forEach(\r\n      collection => this.collectionOptions.push(\r\n        {\r\n          label: collection,\r\n          value: collection,\r\n          disabled: !this.filterService.selectedCollections.has(collection)\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  prepareDeletion() {\r\n    if (!this.memorylistService.activeMemorylistItem) {\r\n      this.memorylistService.activeMemorylistItem = new MemoryListItem(this.filterService.getFilteredTitleIds(),\r\n        '', this.filterService.getFilteredShelfmarks(),\r\n        'manually selected', new Date(), new Date(), [], []);\r\n    }\r\n    if (!this.memorylistService.activeMemorylistItem.titleActions) {\r\n      this.memorylistService.activeMemorylistItem.titleActions = [];\r\n    }\r\n    this.memorylistService.addTitleAction(\r\n      new TitleAction('deletion', this.filterService.uniqueCollections[0], '',\r\n        this.deletionProposal, this.filterService.getFilteredTitleIds(), new Date()));\r\n    this.show['dialog'] = true;\r\n  }\r\n\r\n  confirmDeletion() {\r\n    this.show['dialog'] = false;\r\n  }\r\n\r\n  reset() {\r\n    this.eventanalysiss = new Map<number, Eventanalysis>();\r\n    this.analyses = [];\r\n    this.staticBuffer = 20;\r\n    this.deletionProposal = 0;\r\n    this.yearsOfLoans = 5;\r\n    const stocks = this.dataService.printData.get('stock');\r\n    if (typeof stocks !== 'undefined') {\r\n      const requests = this.dataService.printData.get('requests');\r\n      const oldDate = new Date(stocks[0][0]);\r\n      let year;\r\n      if (typeof requests !== 'undefined') {\r\n        const oldRequestsDate = new Date(requests[0][0]);\r\n        year = Math.min(oldDate.getFullYear(), oldRequestsDate.getFullYear());\r\n      } else {\r\n        year = Math.min(oldDate.getFullYear());\r\n      }\r\n      const actualYear = new Date().getFullYear();\r\n      while (year <= actualYear) {\r\n        if (actualYear - year > 0 && actualYear - year <= 10) {\r\n          this.eventanalysiss.set(actualYear - year, new Eventanalysis('', '', year, 0, 0, 0));\r\n        }\r\n        year++;\r\n      }\r\n      this.calculateAnalysis();\r\n    }\r\n  }\r\n\r\n  calculateAnalysis() {\r\n    this.eventanalysiss.forEach(\r\n      (value: Eventanalysis, key: number) => {\r\n        const analysis = this.calculateSingleAnalysis(this.dataService.printData, key);\r\n        this.eventanalysiss.set(key, analysis);\r\n      }\r\n    );\r\n    this.analyses = [];\r\n    this.eventanalysiss.forEach(entry => this.analyses.push(entry));\r\n    this.activeAnalysis = this.eventanalysiss.get(this.analyses.length / 2);\r\n    this.calculateDeletionProposal();\r\n  }\r\n\r\n  calculateDeletionProposal() {\r\n    if (this.activeAnalysis) {\r\n      const proposal = Math.floor((this.activeAnalysis.lastStock - this.activeAnalysis.maxLoansAbs) * (1 - this.staticBuffer / 100));\r\n      this.deletionProposal = (proposal < 0) ? 0 : proposal;\r\n    }\r\n  }\r\n\r\n  calculateSingleAnalysis(plotData: Map<string, number[][]>, yearsOfLoans: number): Eventanalysis {\r\n    const eventanalysis = this.eventanalysiss.get(yearsOfLoans);\r\n    const dayInMillis = 3600 * 24 * 1000;\r\n    const yearInMillis = 365 * dayInMillis;\r\n    const today = new Date().getTime();\r\n    const startDateLoans = today - yearsOfLoans * yearInMillis;\r\n    const loans = plotData.get('loans');\r\n    const stock = plotData.get('stock');\r\n    eventanalysis.lastStock = stock[stock.length - 1][1];\r\n    let timeLoaned = 0;\r\n    let timeStock = 0;\r\n    let lastTimeLoans = startDateLoans;\r\n    if (typeof loans !== 'undefined') {\r\n      for (const datapoint of loans) {\r\n        if (datapoint[0] > startDateLoans) {\r\n          timeLoaned += (datapoint[0] - lastTimeLoans) * datapoint[1];\r\n          lastTimeLoans = datapoint[0];\r\n          if (datapoint[1] > eventanalysis.maxLoansAbs) {\r\n            eventanalysis.maxLoansAbs = datapoint[1];\r\n          }\r\n        }\r\n      }\r\n    } else {\r\n      eventanalysis.maxLoansAbs = 0;\r\n    }\r\n    for (const datapoint of stock) {\r\n      if (datapoint[0] > startDateLoans) {\r\n        timeStock += (datapoint[0] - lastTimeLoans) * datapoint[1];\r\n        lastTimeLoans = datapoint[0];\r\n      }\r\n    }\r\n    if (timeStock !== 0) {\r\n      eventanalysis.meanRelativeLoan = timeLoaned / timeStock;\r\n    }\r\n    eventanalysis.years = yearsOfLoans;\r\n    return eventanalysis;\r\n  }\r\n}\r\n","import {NgModule} from '@angular/core';\r\nimport {CommonModule} from '@angular/common';\r\nimport {TranslateModule} from '../translate/translate.module';\r\nimport {AnalysisComponent} from './analysis.component';\r\nimport {analysisRouting} from './analysis.routing';\r\nimport {TableModule} from 'primeng/table';\r\nimport {SliderModule} from 'primeng/slider';\r\nimport {FormsModule} from '@angular/forms';\r\nimport {ButtonModule} from 'primeng/button';\r\nimport {DialogModule} from 'primeng/dialog';\r\nimport {DropdownModule, InputTextModule, SpinnerModule} from 'primeng/primeng';\r\n\r\n@NgModule({\r\n  imports: [CommonModule,\r\n    TableModule,\r\n    SliderModule,\r\n    TranslateModule,\r\n    ButtonModule,\r\n    DropdownModule,\r\n    DialogModule,\r\n    FormsModule,\r\n    SpinnerModule,\r\n    InputTextModule,\r\n    analysisRouting, FormsModule],\r\n  declarations: [AnalysisComponent],\r\n  exports: [AnalysisComponent],\r\n  providers: []\r\n})\r\nexport class AnalysisModule {\r\n\r\n}\r\n","import {RouterModule, Routes} from '@angular/router';\r\nimport {ModuleWithProviders} from '@angular/core';\r\nimport {AnalysisComponent} from './analysis.component';\r\n\r\nconst routes: Routes = [\r\n  {path: '', component: AnalysisComponent}\r\n];\r\nexport const analysisRouting: ModuleWithProviders = RouterModule.forChild(routes);\r\n","/**\r\n * Created by etspi on 25.06.2017.\r\n */\r\n\r\nexport class Eventanalysis {\r\n\r\n  constructor(\r\n    public identifier: string,\r\n  public href: string,\r\n  public years: number,\r\n              public meanRelativeLoan: number,\r\n              public lastStock: number,\r\n              public maxLoansAbs: number) {\r\n  }\r\n}\r\n","import {Action} from './Action';\r\n\r\nexport class TitleAction extends Action {\r\n  constructor(\r\n    public actionType: string,\r\n    public collectionFrom: string,\r\n    public collectionTo: string,\r\n    public number: number,\r\n    public titleId: string,\r\n    public created: Date,\r\n    public uuid?: string,\r\n  ) {\r\n    super(actionType, collectionFrom, collectionTo, number, created);\r\n  }\r\n}\r\n"],"sourceRoot":""}